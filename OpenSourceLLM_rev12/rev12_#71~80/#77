#77
# tasks.py
# ------------------------------------------------------------
# [OpenCode 변환본]
# - Closed LLM 의존 없음 (에이전트는 agents.py에서 ChatOllama(DeepSeek-R1) 사용)
# - 원문의 작업 의도를 유지하면서, 실무에서 바로 쓰기 좋은 형태로 강화
#   * 각 Task에 한국어 지시를 명확화
#   * 기대 출력 형식을 구체화(마크다운 구조/목차/톤/길이)
#   * 번역(한국어) 결과는 파일로 저장되도록 output_file 추가
#   * 사람 개입 없이 자동 진행되도록 human_input=False
# ------------------------------------------------------------

from crewai import Task
from agents import planner, writer, editor, translator

# 👉 공통: 마크다운 산출물 기본 가이드(톤/스타일)
MD_STYLE_GUIDE = """
- 한국어 존중체를 사용합니다.
- 문장은 짧고 명확하게, 한 문단에 3~5문장 이내를 권장합니다.
- 가능하면 불필요한 수식어/중복을 제거하고, 사실과 의견을 구분합니다.
- 모든 목록은 -, 1. 2. 형식으로 정리합니다.
"""

# ------------------------------------------------------------
# ① 기획(Planner)
# ------------------------------------------------------------
plan = Task(
    description=(
        "다음 요구사항에 맞춰 {topic}에 대한 **콘텐츠 계획 문서**를 작성하세요.\n\n"
        "요구사항:\n"
        "1) 최신 동향, 주요 인물, 주목할 만한 뉴스를 우선순위에 두고 요약합니다.\n"
        "2) 대상 청중(페르소나)을 2~3개 정의하고, 각자의 관심사/고민/니즈를 정리합니다.\n"
        "3) 소개(인트로) → 본문(핵심 포인트 3~5개) → 결론(CTA) 흐름의 **상세 개요**를 제시합니다.\n"
        "4) SEO 키워드(핵심/롱테일 각 5개 내외)와 참고할 만한 데이터/자료 소스를 나열합니다.\n\n"
        f"{MD_STYLE_GUIDE}"
    ),
    expected_output=(
        "# 콘텐츠 계획서\n"
        "## 개요\n"
        "- 주제: {topic}\n\n"
        "## 최신 동향/뉴스/주요 인물\n"
        "- 동향 요약:\n"
        "- 주목 뉴스:\n"
        "- 주요 인물:\n\n"
        "## 대상 청중(페르소나)\n"
        "- 페르소나 A: 특성/관심/고민/니즈\n"
        "- 페르소나 B: 특성/관심/고민/니즈\n"
        "- (선택) 페르소나 C: ...\n\n"
        "## 콘텐츠 아웃라인\n"
        "- 소개(인트로): 핵심 메시지\n"
        "- 본문 포인트 1: 요지/근거/예시\n"
        "- 본문 포인트 2: 요지/근거/예시\n"
        "- 본문 포인트 3: 요지/근거/예시\n"
        "- (선택) 포인트 4~5\n"
        "- 결론/CTA: 다음 행동 유도\n\n"
        "## SEO\n"
        "- 핵심 키워드(5개 내외)\n"
        "- 롱테일 키워드(5개 내외)\n\n"
        "## 참고 소스\n"
        "- 링크/문서/데이터셋 등\n"
    ),
    agent=planner,
    human_input=False,
)

# ------------------------------------------------------------
# ② 작성(Writer)
# ------------------------------------------------------------
write = Task(
    description=(
        "기획자가 만든 **콘텐츠 계획서**를 기반으로 {topic}에 대한 **마크다운 블로그 글**을 작성하세요.\n\n"
        "요구사항:\n"
        "1) SEO 키워드를 자연스럽게 본문에 녹입니다(키워드 나열 금지, 과도한 반복 금지).\n"
        "2) 섹션/부제목은 매력적이면서도 정보가 드러나도록 작성합니다(H2/H3 활용).\n"
        "3) 소개(후킹), 본문(논리적 전개), 결론/CTA 구조를 지키고, 각 섹션은 2~3개 단락으로 구성합니다.\n"
        "4) 사실과 의견을 구분하고, 가능하면 간단한 근거나 예시를 덧붙입니다.\n"
        "5) 문법/어휘/가독성을 고려해 자연스러운 한국어로 작성합니다.\n\n"
        f"{MD_STYLE_GUIDE}"
    ),
    expected_output=(
        "# 제목: {topic} — (요약 키프레이즈)\n\n"
        "## 소개\n"
        "- 독자의 상황 공감 + 문제 제기 + 본문에서 다룰 핵심 포인트 예고\n\n"
        "## 본문 1: (핵심 포인트)\n"
        "- 설명/근거/예시\n\n"
        "## 본문 2: (핵심 포인트)\n"
        "- 설명/근거/예시\n\n"
        "## 본문 3: (핵심 포인트)\n"
        "- 설명/근거/예시\n\n"
        "## 결론 및 다음 단계(CTA)\n"
        "- 핵심 요약 + 독자 행동 유도\n"
    ),
    agent=writer,
    human_input=False,
)

# ------------------------------------------------------------
# ③ 편집(Editor)
# ------------------------------------------------------------
edit = Task(
    description=(
        "작성된 초안을 **블로그 출판용**으로 교정/편집하세요.\n\n"
        "요구사항:\n"
        "1) 문법/맞춤법/어색한 표현을 교정합니다.\n"
        "2) 문단 간 연결성을 개선하고 중복/군더더기를 제거합니다.\n"
        "3) 과도한 주장/편향/추측은 완화하거나 근거를 보강합니다.\n"
        "4) 제목/부제목/메타 설명(요약 120~160자)을 정리해 SEO 친화적으로 다듬습니다.\n"
        "5) 최종 결과는 **마크다운** 형식으로 반환합니다.\n\n"
        f"{MD_STYLE_GUIDE}"
    ),
    expected_output=(
        "# (교정된) 제목\n\n"
        "> 메타 설명: (120~160자 요약)\n\n"
        "## 소개\n"
        "...\n\n"
        "## 본문 1\n"
        "...\n\n"
        "## 본문 2\n"
        "...\n\n"
        "## 본문 3\n"
        "...\n\n"
        "## 결론 및 다음 단계(CTA)\n"
        "...\n"
    ),
    agent=editor,
    human_input=False,
)

# ------------------------------------------------------------
# ④ 번역/국문화(Translator → 한국어)
# ------------------------------------------------------------
translate_task = Task(
    description=(
        "바로 직전에 편집이 끝난 블로그 글을 **한국어 2단락, 총 5,000자 내외**로 "
        "요약·국문화하여 최종 한국어 버전을 작성하세요. 원문의 핵심 주장과 근거는 보존하되, "
        "한국 독자에게 자연스럽고 매끄럽게 읽히도록 문장을 다듬고 용어를 통일하세요.\n\n"
        "요구사항:\n"
        "1) 정확한 의미 전달과 자연스러운 한국어 표현을 최우선으로 합니다.\n"
        "2) 두 개의 긴 단락으로 구성하되, 논리적 전개가 명확하도록 문장 연결을 매끄럽게 합니다.\n"
        "3) 과도한 반복/군더더기/직역체를 제거합니다.\n"
        "4) 마크다운 헤더/리스트는 사용하지 않고 순수 본문만 작성합니다.\n"
    ),
    expected_output=(
        "한국어 최종 본문(두 단락, 총 5,000자 내외). 마크다운 헤더 없이 순수 본문만 포함."
    ),
    agent=translator,
    human_input=False,
    async_execution=False,            # 순차 파이프라인 보장
    output_file="translated-blog.md", # 최종 한국어 결과 저장
)

